import asyncio
import json
import logging

# é…ç½®æ—¥èªŒ
logging.basicConfig(level=logging.INFO, 
                   format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

async def fake_stream(query: str):
    logger.info(f"é–‹å§‹è™•ç†æŸ¥è©¢: '{query}'")
    
    # Chunk 0: åˆå§‹æ€è€ƒæç¤º
    logger.debug("ç”Ÿæˆåˆå§‹æ€è€ƒæç¤º")
    yield json.dumps({
        "reasoning": [f"æ”¶åˆ°å•é¡Œï¼š{query}ï¼Œæ­£åœ¨æ€è€ƒä¸­...\n**é–‹å§‹åˆ†æ**"],
        "finalized": False
    }) + "\n"
    await asyncio.sleep(2)
    logger.debug("åˆå§‹æ€è€ƒæç¤ºå·²ç”Ÿæˆ")
    
    # Chunk 1: éƒ¨åˆ†æ¨ç†æ­¥é©Ÿ
    logger.debug("ç”Ÿæˆéƒ¨åˆ†æ¨ç†æ­¥é©Ÿ1")
    yield json.dumps({
        "reasoning": [
            "### æ­¥é©Ÿ1ï¼šè³‡æ–™åˆ†æ\n\n" +
            "| åˆ†æé …ç›® | ç‹€æ…‹ | èªªæ˜ |\n" +
            "|----------|------|------|\n" +
            "| æ•¸æ“šæ¸…ç† | âœ… | å·²å®Œæˆåˆæ­¥è™•ç† |\n" +
            "| æ ¼å¼é©—è­‰ | â³ | é€²è¡Œä¸­ |\n" +
            "| ç•°å¸¸æª¢æ¸¬ | ğŸ”„ | å¾…è™•ç† |\n\n" +
            "#### å¾…è¾¦äº‹é …ï¼š\n\n" +
            "- [x] å°å…¥åŸå§‹æ•¸æ“š\n" +
            "- [ ] åŸ·è¡Œæ•¸æ“šè½‰æ›\n" +
            "- [ ] ç”Ÿæˆåˆ†æå ±å‘Š"
        ],
        "finalized": False
    }) + "\n"
    await asyncio.sleep(3)
    logger.debug("éƒ¨åˆ†æ¨ç†æ­¥é©Ÿ1å·²ç”Ÿæˆ")
    
    # Chunk 2: éƒ¨åˆ†æ¨ç†æ­¥é©Ÿ
    logger.debug("ç”Ÿæˆéƒ¨åˆ†æ¨ç†æ­¥é©Ÿ2")
    yield json.dumps({
        "reasoning": [
            "### æ­¥é©Ÿ2ï¼šæŠ€è¡“ç´°ç¯€\n\n" +
            "> ğŸ’¡ **é‡è¦æç¤º**\n" +
            "> ä»¥ä¸‹æ˜¯æ ¸å¿ƒè™•ç†é‚è¼¯ï¼š\n\n" +
            "```python\n" +
            "def process_data(data):\n" +
            "    return {\n" +
            "        'status': 'success',\n" +
            "        'metrics': {\n" +
            "            'accuracy': 0.95,\n" +
            "            'recall': 0.89\n" +
            "        }\n" +
            "    }\n" +
            "```\n\n" +
            "#### æ€§èƒ½æŒ‡æ¨™\n\n" +
            "| æŒ‡æ¨™ | æ•¸å€¼ | ç›®æ¨™ |\n" +
            "|------|------|------|\n" +
            "| æº–ç¢ºç‡ | 95% | 90% |\n" +
            "| å¬å›ç‡ | 89% | 85% |\n" +
            "| è™•ç†æ™‚é–“ | 1.2s | 2.0s |"
        ],
        "finalized": False
    }) + "\n"
    logger.debug("éƒ¨åˆ†æ¨ç†æ­¥é©Ÿ2å·²ç”Ÿæˆ")

    # Chunk 3: æœ€çµ‚ç­”æ¡ˆ
    logger.debug("ç”Ÿæˆæœ€çµ‚ç­”æ¡ˆ")
    yield json.dumps({
        "message": (
            "# åˆ†æå ±å‘Š\n\n" +
            f"## æŸ¥è©¢ï¼š'{query}'\n\n" +
            "### ä¸»è¦ç™¼ç¾\n\n" +
            "| é¡åˆ¥ | çµæœ | å¯ä¿¡åº¦ |\n" +
            "|------|------|--------|\n" +
            "| é¡å‹A | æ­£é¢ | é«˜ |\n" +
            "| é¡å‹B | ä¸­æ€§ | ä¸­ |\n" +
            "| é¡å‹C | å¾…å®š | ä½ |\n\n" +
            "### è©³ç´°èªªæ˜\n\n" +
            "> ğŸ“Š **æ•¸æ“šæ‘˜è¦**\n" +
            "> - æ¨£æœ¬æ•¸é‡ï¼š1000\n" +
            "> - è™•ç†æ™‚é–“ï¼š1.2ç§’\n" +
            "> - æº–ç¢ºåº¦ï¼š95%\n\n" +
            "#### æŠ€è¡“ç´°ç¯€\n\n" +
            "```json\n" +
            "{\n" +
            "    \"status\": \"success\",\n" +
            "    \"version\": \"1.0.0\",\n" +
            "    \"timestamp\": \"2024-03-21\"\n" +
            "}\n" +
            "```"
        ),
        "reasoning": [
            "### æ­¥é©Ÿ3ï¼šæœ€çµ‚ç¸½çµ\n\n" +
            "- âœ… æ•¸æ“šåˆ†æå®Œæˆ\n" +
            "- ğŸ“ˆ æ€§èƒ½é”æ¨™\n" +
            "- ğŸ“‹ å ±å‘Šç”Ÿæˆ"
        ],
        "finalized": True
    }) + "\n"
    logger.info(f"æŸ¥è©¢ '{query}' è™•ç†å®Œæˆ")

    return # çµæŸç”Ÿæˆå™¨